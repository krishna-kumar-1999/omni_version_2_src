
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div class="card fullHeightCard">
            <div class="body">
                 <div id="plist" class="people-list chat-search-list">
                       <div class="chat-search">
            
                                <!-- <div class="sidebar-add-btn">
                                    <button  type="button" class="btn btn-primary" (click)="broadtag()" >BroadCast</button>
                                </div> -->
                                <div class="input-group"> 
                                  
                                    <input type="text" class="form-control"  placeholder="Search..." #chat_search (keyup.enter)="chatPanelList(chat_search.value)">
                                    <input type="hidden" name="open_chat_detail_id" id="open_chat_detail_id" value="0" #open_chat_detail_id (click)='chatPanelDetail(open_chat_detail_id.value)'>
                                    <span ></span>
                                    <div class="input-chat_search-append">
                                        <button class="btn btn-primary chat_list_search" (click)="chatPanelList(chat_search.value)"><i class="fas fa-search"></i></button>
                                    </div>
                                </div>
            
                         </div>
                        <div class="m-b-20">
                            <div id="chat-scroll">
                                <ul class="chat-list list-unstyled m-b-0 chat_list_data">
                    
                                <li class="clearfix" *ngFor="let chat_list of chat_panel_list;let i=index" [id]="'chat_'+chat_list.chat_id" (click)="chatPanelDetail(chat_list.chat_id)">
                    
  
                                  <div class="about">
                                     <div class="name">
                                       <img  class="thumbnail-image" src="{{chat_list.profile_picture}}"
                                       onerror="this.src='assets/images/user.jpg'"
                                         alt="..." width="50px" height="50px"style="margin-right: 5px;"/>
                                                                 <b>{{chat_list.displayName}}</b>
                                      </div>
                                      <div style="display: flex;"> <div class="bullet"> </div> {{chat_list.chat_dt}}</div>
                                  </div>
  
                                
                                <!-- <div class="about">
                                  <div class="name">
                                    <img  class="thumbnail-image" src="{{chat_list.profile_picture}}"
                                       alt="..." width="50px" height="50px" style="margin-right: 5px;"/>
                                       <b>{{chat_list.displayName}}</b> 
                                    </div>
                                  <div class="text-small text-muted"> <div class="bullet"></div> {{chat_list.chat_dt}}</div>
  
                                </div> -->
                                   <!-- <div class="about"> 
                                          <div class="name"><b>{{chat_list.page_name}}</b> - {{chat_list.first_name}}</div>
                                        <div class="text-small text-muted"> <div class="bullet"></div> {{chat_list.chat_dt}}</div>
                                    </div>  -->
                                </li>
                    
                                </ul>
                    
                            </div>
                        </div>
                 </div>
            </div>
        </div>
    </div>
     <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9" id="chat_details_view" (paste)="onPaste($event,this.recipient_id,this.sender_id)">
                <div class="card fullHeightCard keep-connect-chat-content" *ngIf="chat_panel_detail_type=='chat_screen'">
                  <a href="https://omni.mconnectapps.com/api/v1.0/pro_contents/line.pdf"  target="_blank"><i style="font-size: 24px;padding-right: 20px;
                    padding-top: 20px;float: right;" class="fa fa-exclamation-circle"></i></a>
                  <div class="card-body">
                        <div class="keep-connect">
                            <div class="connect-logo">
                                <img src="assets/img/logo.png">
                                <span class="logo-name">Omni Line Messenger Chat</span>
                            </div>
                            <h3>Keep your device connected</h3>
                            <p>To reduce data usage, <br>connect your phone to Wi-Fi.</p> 
                        </div>
                    </div>
                </div>
  
        <div class="card" *ngIf="chat_panel_detail_type=='chat_detail'">
                    <div class="chat">
                    <div class="chat-header clearfix">
                        <img src="{{profile_pic}}" onerror="this.src='assets/images/user.jpg' " width="50px" height="50px" alt="avatar">
                        <div class="chat-about">
                                <div class="chat-with">{{this.displayName}}</div> 
                                <div class="chat-num-messages">Line Messenger</div> 
                                <div title="{{this.tag_name}}" id="chat-message"class="chat-num-messages">{{this.tag_name}}</div>
                              </div>
                              <span class="user-icon editicon" style="cursor: pointer;"><i class="far fa-edit" (click)="editname()"></i></span>
                              <img src="assets/img/mc-dashboard/line.png" alt="avatar" style="float: right;">
                              <!-- <button type="button" *ngIf="this.contact_id != null" class="btn btn-primary username" (click)="generateticket(this.chat_detail_key)">Generate ticket</button>
                              <button type="button" *ngIf="this.contact_id == null" class="btn btn-primary username" (click)="addcontact(this.displayName,this.chat_detail_key)">+ Add Contact</button>
                              <button type="button" *ngIf="this.contact_id != null" class="btn btn-primary username" (click)="viewcontact(this.contact_id,this.phone)">+ View Contact</button> -->
                              <!-- <button type="button"  class="btn btn-primary uploadtag" (click)="addtag()">+ Add Tags</button> -->
                    </div>
                    </div>
              <div class="chat-box" id="mychatbox">
                        <div class="card-body chat-content">
                            <div *ngFor="let chat_details of chat_panel_details;let i=index">
  
  
                                   <div class="chat-item chat-left" *ngIf="chat_details.recipient_id == recipient_id"> 
                                      <img src="{{chat_details.profile_picture}}" onerror="this.src='assets/images/user.jpg'" width="60px" height="50px">
                                      <div class="chat-details">
                                        <!-- <img href="{{chat_details.message_attachment}}" src="{{chat_details.message_attachment}}">   -->
                                        <div
                                          *ngIf="chat_details.extension== 'doc' ||chat_details.extension=='docx'||chat_details.extension == 'pdf'||chat_details.extension == 'csv' || chat_details.extension =='txt' || chat_details.extension == 'xlsx';"
                                          class="chat-text" style="white-space: pre-line;">
                                          <div *ngIf="chat_details.attachment" style="max-width: 250px;"> <a target="_blank"
                                              href="{{chat_details.attachment}}"><img src="assets/images/icons/quickView.png">
                                              <b>{{chat_details.extension}}</b> </a>
                                          </div>
                                          <div class="chat-time">Click to View File</div>
                        
                                        </div>
                                        <div
                                          *ngIf="chat_details.extension!= 'doc' && chat_details.extension != 'docx' && chat_details.extension != 'pdf' &&chat_details.extension != 'csv' && chat_details.extension !='txt' && chat_details.extension != 'xlsx';"
                                          class="chat-text" style="white-space: pre-line;">
                                          <div *ngIf="chat_details.attachment" style="max-width: 250px;"> <a target="_blank"
                                              href="{{chat_details.attachment}}"><img href="{{chat_details.attachment}}"
                                                src="{{chat_details.attachment}}"
                                                onerror=" this.src='assets/images/icons/quickView.png'"> </a></div>
                                          {{chat_details.chat_msg}}
                                        </div>
                                        <div class="chat-time">{{chat_details.Time}}</div>
                                      </div>
                                    </div>
                    
                    
                                    <!-- <div class="chat-item chat-right" *ngIf="chat_details.msg_user_type == 'agent' && chat_details.msg_user_id == loginUser"><img src="assets/images/user.jpg" >  -->
                                    <div class="chat-item chat-right" *ngIf="chat_details.recipient_id != recipient_id">
  
                                      <img src="{{chat_details.profile_picture}}" onerror="this.src='assets/images/user.jpg'" width="70px" height="50px" > 
                                      <div class="chat-details">
                                        <!-- <img href="{{chat_details.message_attachment}}" src="{{chat_details.message_attachment}}">   -->
                                        <div
                                          *ngIf="chat_details.extension== 'doc' ||chat_details.extension=='docx'||chat_details.extension == 'pdf'||chat_details.extension == 'csv' || chat_details.extension =='txt' || chat_details.extension == 'xlsx';"
                                          class="chat-text" style="white-space: pre-line;">
                                          <div *ngIf="chat_details.attachment" style="max-width: 250px;"> <a target="_blank"
                                              href="{{chat_details.attachment}}"><img src="assets/images/icons/quickView.png">
                                              <b>{{chat_details.extension}}</b> </a>
                                          </div>
                                          <div class="chat-time">Click to View File</div>
                        
                                        </div>
                                        <div
                                          *ngIf="chat_details.extension!= 'doc' && chat_details.extension != 'docx' && chat_details.extension != 'pdf' &&chat_details.extension != 'csv' && chat_details.extension !='txt' && chat_details.extension != 'xlsx';"
                                          class="chat-text" style="white-space: pre-line;">
                                          <div class="chat-time">{{chat_details.user_name}}</div>
                                          <div *ngIf="chat_details.attachment" style="max-width: 250px;"> <a target="_blank"
                                              href="{{chat_details.attachment}}"><img href="{{chat_details.attachment}}"
                                                src="{{chat_details.attachment}}"
                                                onerror=" this.src='assets/images/icons/quickView.png'"> </a></div>
                                          {{chat_details.chat_msg}}
                                        </div>
                                        <div class="chat-time">{{chat_details.Time}}</div>
                                      </div>
                
                                    </div>
                                    <div class="chat-item chat-right" *ngIf="chat_details.msg_user_type == 'agent' && chat_details.msg_user_id == loginUser"><img src="assets/images/user.jpg" > 
                                      <div class="chat-details">
                                        <div class="chat-text {{chat_details.msg_status}}" >{{chat_details.chat_msg}}</div>    
                                        <div class="message-status-img">
                                         <img *ngIf="chat_details.msg_status == 'DELIVERED'" src="assets/images/whatsapp-double-grey.svg" height="20">
                                         <img *ngIf="chat_details.msg_status == 'READ'"  src="assets/images/whatsapp-double-blue.svg" height="20"> 
                                         <img *ngIf="chat_details.msg_status == 'SENT'"  src="assets/images/whatsapp-single-grey.svg" height="15">
                           
                                       </div>
                                       <div class="chat-time">
                                         {{chat_details.chat_time}}
                                       </div>
                                     </div>
                                   </div>
                            </div>
                        </div>
                        <div class="card-footer chat-form">
                                <textarea class="form-control" id="chat_msg" placeholder="Type a message" style="height: 50px;" (keydown)="onMessageSend($event,this.recipient_id,this.sender_id)" #chat_message></textarea>
                                <input type="hidden" name="chat_id" id="chat_detail_id" value="{{chat_detail_key}}" #chat_detail_id>
                                <!-- <button type="button" class="btn btn-primary" data-toggle="modal" (click)="template()" style="right: 105px;">
                                  <i class="fas fa-fill-drip"></i>
                                </button> -->
                                <input type="hidden" name="line_media_url" id="line_media_url" >
                                <input type="hidden"  id="hit_image" (click)="sendChatMediaData()">
                                <button type="button" class="btn btn-primary" (click)="template()" style="right: 85px;" >
                                  <i class="fas fa-fill-drip"></i>
                                </button>
                                 <button type="button" class="btn btn-primary" (click)="sendmedia(this.recipient_id,this.sender_id)" data-toggle="modal" data-target="#createNewWidget" style="right: 40px;">
                                  <i class="fas fa-link"></i>
                                </button> 
                                <button type="button" class="btn btn-primary" (click)="sendChatMessageData(this.recipient_id,this.sender_id)">
                                <i class="far fa-paper-plane"></i>
                                </button>
                        </div>
                </div>
         </div>
  
    </div>
  </div>
  
  
  <!-- UPLOAD MEDIA -->
  <div class="modal fade" id="createNewWidget">
  <div class="modal-dialog modal-md">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="myLargeModalLabel">Upload Media File (PNG, MP4 files up to 5 mb)</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body"> 
      <div class="row">
        <div class="col-12 col-md-12">
          <div class="row">
            <div class="col-md-12 col-12">
              <div class="form-group">
                <input type="file" class="form-control" name="line_media" id="line_media" (keydown)="onimageSend($event,this.recipient_id,this.sender_id)">
              </div>
            </div>
  
  
          </div>
        </div>
  
      </div>	
    </div>
  
    <div class="modal-footer">
      <div class="buttons">
        <input type="button" data-dismiss="modal" class="btn btn-outline-secondary" value="Cancel">
        <input type="button" class="btn btn-primary update_agent" value="Submit"  (click)="addWhatsappMedia(this.recipient_id,this.sender_id)">
        <input type="hidden" id="chat_details_call" (click)="chatPanelDetail(this.chat_detail_id.nativeElement.value)">
      </div>
    </div>
  </div>
  </div>
  </div>
  
  
  
  
  
  
  
  
  <!-- NAME UPDATE -->
  <div class="modal fade bd-example-modal-md" id="add_nameform">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <form [formGroup]="updatenameform">
                <div class="modal-header">
                    <h5 class="modal-title" id="myLargeModalLabel">Update Agents</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                      <div class="col-md-12">
                      <label for="update_name">Search Tags</label>
                  <div class="input-group"><input type="text" class="form-control" placeholder="Search Tag Name" [formControl]="searching">
                    <div class="input-group-append">
                        <button class="btn btn-primary" (click)=display_tags_list()><i class="fas fa-search"></i></button>
                    </div>
                </div>
              </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="update_name">Update Name</label>
                                <input class="form-control" id="update_name" formControlName="update_name" [(ngModel)]="update_names">          
                               </div>
                        </div>
                        <!-- <label for="update_name">Add Tags</label> -->
              <!-- <div class="col-md-12">
                
                  <mat-form-field appearance="fill" id="tagggs">
                  <mat-label>Tags</mat-label>
                  <mat-select [formControl]="toppings" multiple [(ngModel)]="selected">
                    <mat-option (onSelectionChange)="getValues($event)" *ngFor="let tags of tags_list" id="tagsdata" [value]="tags.tag_name" >{{tags.tag_name}}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div> -->
  
  
                
              </div>
            </div>
                
                <div class="modal-footer">
                    <div class="buttons">
                        <input type="button" data-dismiss="modal" class="btn btn-outline-secondary" value="Cancel">
                        <input type="submit" class="btn btn-primary update_name" value="Submit" (click)="update_name(sender_id)" [disabled]="!updatenameform.valid">
                    </div>
                </div>
            </form>
  
        </div>
    </div>
  </div>
  
  
  
  
  
  <div class="modal fade bd-example-modal-md" id="displaytagform">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <form [formGroup]="tagnameform">
                <div class="modal-header">
                    <h5 class="modal-title" id="myLargeModalLabel">BroadCast</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                  <label for="update_name">Search Tags</label>
                  <div class="input-group"><input type="text" class="form-control" placeholder="Search Tag Name" [formControl]="searching">
                    <div class="input-group-append">
                        <button class="btn btn-primary" (click)=display_tags_list()><i class="fas fa-search"></i></button>
                    </div>
                </div>
                  <label for="update_name">Select Tags</label>
                    <div class="row">
              <!-- <div class="col-md-12">
                  <mat-form-field appearance="fill" id="tagggs">
                  <mat-label>Tags</mat-label>
                  <mat-select [formControl]="topp" id="tagsdata" multiple>
                    <mat-option (onSelectionChange)="getValues2($event)" *ngFor="let tags of tags_list" selected="true" [value]="tags.tag_name" >{{tags.tag_name}}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div> -->
  
              <div class="col-md-12">
                <textarea id="textmessage" formControlName="broadtag" placeholder="type your message..." ></textarea>
              </div>
  
              </div>
            </div>
                
                <div class="modal-footer">
                    <div class="buttons">
                        <input type="button" data-dismiss="modal" class="btn btn-outline-secondary" value="Cancel">
                        <input type="submit" class="btn btn-primary update_name" value="Submit" (click)="broadcasttag()">
                    </div>
                </div>
            </form>
  
        </div>
    </div>
  </div>
  
  
  
  
  
  
  
  
  
  
  <div class="modal fade" id="PasteImage">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myLargeModalLabel">Send Image</h5>
                <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button> -->
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12 col-md-12">
                        <div class="row">
                           
                          <img style="width: 100%;" [src]='imgRenderer' #imgRenderer />
  
  
  
                        </div>
                    </div>
  
                </div>	
            </div>
  
            <div class="modal-footer">
                <div class="buttons">
                    <input type="button" data-dismiss="modal" class="btn btn-outline-secondary"   id="dis_card" value="Cancel">
                    <input type="button" class="btn btn-primary update_agent" value="Send" id="get_card">
                </div>
            </div>
        </div>
    </div>
  </div>
  